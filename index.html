<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OTM 300 Exam Calculators</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; line-height: 1.35; }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { margin-bottom: 8px; }
    .note { color: #444; margin-top: 0; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { display: block; font-weight: 600; margin-bottom: 4px; }
    input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; }
    button { padding: 10px 14px; border: 1px solid #aaa; border-radius: 8px; background: #f7f7f7; cursor: pointer; font-size: 16px; }
    button:hover { background: #eee; }
    .row { display: flex; gap: 10px; align-items: end; flex-wrap: wrap; }
    .result { font-size: 18px; font-weight: 700; padding: 10px; background: #fafafa; border: 1px dashed #bbb; border-radius: 8px; }
    .small { font-size: 13px; color: #555; }

    /* Dropdown (details/summary) styles */
    details.calc {
      border: 1px solid #ddd;
      border-radius: 10px;
      margin: 12px 0;
      background: #fff;
    }

    details.calc > summary {
      padding: 14px 16px;
      cursor: pointer;
      font-weight: 700;
      list-style: none;
      user-select: none;
    }

    details.calc > summary::-webkit-details-marker { display: none; }

    details.calc > summary::before {
      content: "▶";
      display: inline-block;
      width: 22px;
      margin-right: 6px;
      transform: translateY(-1px);
    }

    details.calc[open] > summary::before { content: "▼"; }

    details.calc .content { padding: 0 16px 16px 16px; }

    .section-title { margin: 12px 0 6px 0; }

    /* Input with unit selector */
    .input-with-unit {
      display: grid;
      grid-template-columns: 1fr 180px;
      gap: 10px;
      align-items: end;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    @media (max-width: 700px) {
      .grid { grid-template-columns: 1fr; }
      .input-with-unit { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>OTM 300 Exam Calculators</h1>
    <p class="note">This page does not store data. Refreshing resets values.</p>

    <div class="row" style="margin: 12px 0 18px 0;">
      <button type="button" onclick="openAll()">Expand all</button>
      <button type="button" onclick="closeAll()">Collapse all</button>
      <button type="button" onclick="resetAll()">Reset all</button>
    </div>

    <details class="calc" open>
      <summary>Simple Calculator</summary>
      <div class="content">
        <div class="grid">
          <div>
            <label for="a">Number A</label>
            <input id="a" type="number" step="any" placeholder="e.g., 12.5">
          </div>
          <div>
            <label for="b">Number B</label>
            <input id="b" type="number" step="any" placeholder="e.g., 3">
          </div>
        </div>

        <div class="row" style="margin-top: 12px;">
          <div style="min-width: 200px;">
            <label for="op">Operation</label>
            <select id="op">
              <option value="add">A + B</option>
              <option value="sub">A - B</option>
              <option value="mul">A × B</option>
              <option value="div">A ÷ B</option>
            </select>
          </div>
          <button type="button" onclick="runBasic()">Compute</button>
          <button type="button" onclick="resetBasic()">Reset</button>
        </div>

        <div style="margin-top: 12px;">
          <div class="small">Result</div>
          <div class="result" id="basicResult">-</div>
        </div>
      </div>
    </details>

    <details class="calc">
      <summary>2. Intro to Operations</summary>
      <div class="content">
        <h3 class="section-title">Little’s Law</h3>

        <p class="small">
          Formula: <strong class="mono">I = R × T</strong>,
          where <strong>I</strong> is average inventory (flow units),
          <strong>R</strong> is average flow rate (flow units per time),
          and <strong>T</strong> is average flow time (time).
          Little’s Law describes <em>average</em> values.
        </p>

        <div class="row">
          <div style="flex: 1; min-width: 320px;">
            <label for="modeLittle">What do you want to solve for?</label>
            <select id="modeLittle" onchange="updateLittleUI()">
              <option value="solveI">Solve for I (given R and T)</option>
              <option value="solveT">Solve for T (given I and R)</option>
              <option value="solveR">Solve for R (given I and T)</option>
            </select>
          </div>

          <div style="flex: 1; min-width: 220px;">
            <label for="roundLittle">Rounding</label>
            <select id="roundLittle">
              <option value="none">No rounding</option>
              <option value="2">Round to 2 decimals</option>
              <option value="3">Round to 3 decimals</option>
              <option value="0">Round to whole number</option>
            </select>
          </div>
        </div>

        <div class="grid" style="margin-top: 12px;">
          <div>
            <div class="input-with-unit">
              <div>
                <label id="xLabel" for="xInput">Flow rate, R</label>
                <input id="xInput" type="number" step="any" placeholder="e.g., 4">
              </div>
              <div>
                <label id="xUnitLabel" for="xUnit">Units</label>
                <select id="xUnit"></select>
              </div>
            </div>
          </div>

          <div>
            <div class="input-with-unit">
              <div>
                <label id="yLabel" for="yInput">Flow time, T</label>
                <input id="yInput" type="number" step="any" placeholder="e.g., 30">
              </div>
              <div>
                <label id="yUnitLabel" for="yUnit">Units</label>
                <select id="yUnit"></select>
              </div>
            </div>
          </div>
        </div>

        <div class="row" style="margin-top: 12px;">
          <button type="button" onclick="runLittle()">Compute</button>
          <button type="button" onclick="resetLittle()">Reset</button>
        </div>

        <div style="margin-top: 12px;">
          <div class="small">Result</div>
          <div class="result" id="littleResult">-</div>
          <div class="small" id="littleConversions" style="margin-top: 6px;"></div>
        </div>

        <p class="small" style="margin-top: 10px;">
          Tip: Use the unit dropdowns so the calculator handles time conversions.
        </p>
      </div>
    </details>
  </div>

<script>
  /* -------- Helpers -------- */
  function parseNum(id) {
    const v = document.getElementById(id).value;
    if (v === "" || v === null) return null;
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  }

  function formatResult(value, roundSelectId) {
    const roundEl = document.getElementById(roundSelectId);
    const roundMode = roundEl ? roundEl.value : "none";
    if (roundMode === "none") return String(value);

    const decimals = Number(roundMode);
    if (!Number.isFinite(decimals)) return String(value);

    return value.toFixed(decimals);
  }

  function setText(id, txt) {
    document.getElementById(id).textContent = txt;
  }

  function clearText(id) {
    document.getElementById(id).textContent = "";
  }

  function isNonNegative(n) {
    return typeof n === "number" && Number.isFinite(n) && n >= 0;
  }

  /* -------- Expand/Collapse Controls -------- */
  function openAll() {
    document.querySelectorAll("details.calc").forEach(d => d.open = true);
  }

  function closeAll() {
    document.querySelectorAll("details.calc").forEach(d => d.open = false);
  }

  function resetAll() {
    resetBasic();
    resetLittle();
  }

  /* -------- Simple Calculator -------- */
  function runBasic() {
    const a = parseNum("a");
    const b = parseNum("b");
    const op = document.getElementById("op").value;

    if (a === null || b === null) {
      setText("basicResult", "Enter values for A and B.");
      return;
    }

    let out;

    if (op === "add") out = a + b;
    if (op === "sub") out = a - b;
    if (op === "mul") out = a * b;
    if (op === "div") {
      if (b === 0) {
        setText("basicResult", "Cannot divide by zero.");
        return;
      }
      out = a / b;
    }

    setText("basicResult", out);
  }

  function resetBasic() {
    document.getElementById("a").value = "";
    document.getElementById("b").value = "";
    document.getElementById("op").value = "add";
    setText("basicResult", "-");
  }

  /* -------- Little’s Law (I = R * T) with unit conversion -------- */

  // Base time unit: hour
  const TIME_TO_HOURS = {
    "seconds": 1 / 3600,
    "minutes": 1 / 60,
    "hours": 1,
    "days": 24
  };

  // For rates, we store as "per <time unit>" and convert to per hour.
  const RATE_TO_PER_HOUR = {
    "per second": 3600,
    "per minute": 60,
    "per hour": 1,
    "per day": 1 / 24
  };

  function fillSelect(selectEl, options) {
    selectEl.innerHTML = "";
    for (const opt of options) {
      const o = document.createElement("option");
      o.value = opt.value;
      o.textContent = opt.label;
      selectEl.appendChild(o);
    }
  }

  function setUnitModeForSolveI() {
    // Inputs: R (rate) and T (time)
    const xUnit = document.getElementById("xUnit");
    const yUnit = document.getElementById("yUnit");

    fillSelect(xUnit, [
      { value: "per hour", label: "flow units per hour" },
      { value: "per minute", label: "flow units per minute" },
      { value: "per day", label: "flow units per day" }
    ]);

    fillSelect(yUnit, [
      { value: "minutes", label: "minutes" },
      { value: "hours", label: "hours" },
      { value: "days", label: "days" }
    ]);

    // sensible defaults
    xUnit.value = "per hour";
    yUnit.value = "hours";

    document.getElementById("xUnitLabel").textContent = "Rate units";
    document.getElementById("yUnitLabel").textContent = "Time units";
  }

  function setUnitModeForSolveT() {
    // Inputs: I (inventory) and R (rate)
    const xUnit = document.getElementById("xUnit");
    const yUnit = document.getElementById("yUnit");

    fillSelect(xUnit, [
      { value: "flow units", label: "flow units" }
    ]);

    fillSelect(yUnit, [
      { value: "per hour", label: "flow units per hour" },
      { value: "per minute", label: "flow units per minute" },
      { value: "per day", label: "flow units per day" }
    ]);

    xUnit.value = "flow units";
    yUnit.value = "per hour";

    document.getElementById("xUnitLabel").textContent = "Inventory units";
    document.getElementById("yUnitLabel").textContent = "Rate units";
  }

  function setUnitModeForSolveR() {
    // Inputs: I (inventory) and T (time)
    const xUnit = document.getElementById("xUnit");
    const yUnit = document.getElementById("yUnit");

    fillSelect(xUnit, [
      { value: "flow units", label: "flow units" }
    ]);

    fillSelect(yUnit, [
      { value: "minutes", label: "minutes" },
      { value: "hours", label: "hours" },
      { value: "days", label: "days" }
    ]);

    xUnit.value = "flow units";
    yUnit.value = "hours";

    document.getElementById("xUnitLabel").textContent = "Inventory units";
    document.getElementById("yUnitLabel").textContent = "Time units";
  }

  function updateLittleUI() {
    const mode = document.getElementById("modeLittle").value;

    const xLabel = document.getElementById("xLabel");
    const yLabel = document.getElementById("yLabel");
    const xInput = document.getElementById("xInput");
    const yInput = document.getElementById("yInput");

    xInput.value = "";
    yInput.value = "";
    setText("littleResult", "-");
    clearText("littleConversions");

    if (mode === "solveI") {
      xLabel.textContent = "Flow rate, R";
      yLabel.textContent = "Flow time, T";
      xInput.placeholder = "e.g., 4";
      yInput.placeholder = "e.g., 30";
      setUnitModeForSolveI();
    }

    if (mode === "solveT") {
      xLabel.textContent = "Inventory, I (average inventory in system)";
      yLabel.textContent = "Flow rate, R";
      xInput.placeholder = "e.g., 200";
      yInput.placeholder = "e.g., 4";
      setUnitModeForSolveT();
    }

    if (mode === "solveR") {
      xLabel.textContent = "Inventory, I (average inventory in system)";
      yLabel.textContent = "Flow time, T";
      xInput.placeholder = "e.g., 200";
      yInput.placeholder = "e.g., 2";
      setUnitModeForSolveR();
    }
  }

  function runLittle() {
    const mode = document.getElementById("modeLittle").value;
    const x = parseNum("xInput");
    const y = parseNum("yInput");

    if (x === null || y === null) {
      setText("littleResult", "Enter both inputs.");
      clearText("littleConversions");
      return;
    }

    if (!isNonNegative(x) || !isNonNegative(y)) {
      setText("littleResult", "Inputs must be non-negative numbers.");
      clearText("littleConversions");
      return;
    }

    const xUnit = document.getElementById("xUnit").value;
    const yUnit = document.getElementById("yUnit").value;

    // Preferred display units for outputs
    // For T output: time unit dropdown (we'll use a sensible default based on current context)
    // For R output: rate unit dropdown
    let out, conversionsNote = "";

    if (mode === "solveI") {
      // Inputs: R (rate) and T (time)
      const R_per_hour = x * (RATE_TO_PER_HOUR[xUnit] ?? 1);
      const T_hours = y * (TIME_TO_HOURS[yUnit] ?? 1);

      out = R_per_hour * T_hours; // flow units

      const shown = formatResult(out, "roundLittle");
      setText("littleResult", "I = " + shown + " flow units");
      conversionsNote = `Converted to base units: R = ${R_per_hour} flow units/hour, T = ${T_hours} hours.`;
      setText("littleConversions", conversionsNote);
      return;
    }

    if (mode === "solveT") {
      // Inputs: I (flow units) and R (rate)
      const I = x;
      const R_per_hour = y * (RATE_TO_PER_HOUR[yUnit] ?? 1);

      if (R_per_hour === 0) {
        setText("littleResult", "Flow rate R must be > 0.");
        clearText("littleConversions");
        return;
      }

      const T_hours = I / R_per_hour;

      // Choose a display time unit (simple rule: if hours < 1, show minutes; else hours)
      // Students can still control inputs via dropdown; this is only for output readability.
      let displayUnit = "hours";
      if (T_hours < 1) displayUnit = "minutes";
      if (T_hours >= 24) displayUnit = "days";

      const T_display = T_hours / (TIME_TO_HOURS[displayUnit] ?? 1);
      const shown = formatResult(T_display, "roundLittle");
      setText("littleResult", "T = " + shown + " " + displayUnit);
      conversionsNote = `Converted to base units: R = ${R_per_hour} flow units/hour, so T = ${T_hours} hours.`;
      setText("littleConversions", conversionsNote);
      return;
    }

    if (mode === "solveR") {
      // Inputs: I (flow units) and T (time)
      const I = x;
      const T_hours = y * (TIME_TO_HOURS[yUnit] ?? 1);

      if (T_hours === 0) {
        setText("littleResult", "Flow time T must be > 0.");
        clearText("littleConversions");
        return;
      }

      const R_per_hour = I / T_hours;

      // Choose a display rate unit (simple rule: default per hour; if small, per minute; if huge timeframe, per day)
      let displayRateUnit = "per hour";
      if (R_per_hour < 1) displayRateUnit = "per minute";
      if (R_per_hour > 24 * 10) displayRateUnit = "per day"; // coarse heuristic

      const factor = RATE_TO_PER_HOUR[displayRateUnit] ?? 1; // per hour conversion factor
      const R_display = R_per_hour / factor;

      const shown = formatResult(R_display, "roundLittle");
      const label = (displayRateUnit === "per minute") ? "flow units/minute"
                 : (displayRateUnit === "per day") ? "flow units/day"
                 : "flow units/hour";

      setText("littleResult", "R = " + shown + " " + label);
      conversionsNote = `Converted to base units: T = ${T_hours} hours, so R = ${R_per_hour} flow units/hour.`;
      setText("littleConversions", conversionsNote);
      return;
    }
  }

  function resetLittle() {
    document.getElementById("modeLittle").value = "solveI";
    document.getElementById("roundLittle").value = "none";
    updateLittleUI();
  }

  /* -------- Accordion behavior (only one open at a time) --------
     If you want multiple dropdowns open at once, delete this block.
  */
  document.querySelectorAll("details.calc").forEach(d => {
    d.addEventListener("toggle", () => {
      if (d.open) {
        document.querySelectorAll("details.calc").forEach(other => {
          if (other !== d) other.open = false;
        });
      }
    });
  });

  /* Initialize */
  updateLittleUI();
</script>
</body>
</html>
