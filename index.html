<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OTM 300 Calculators</title>

  <meta name="copyright" content="© 2026 Amir. All rights reserved.">
  <meta name="description" content="OTM 300 Exam Calculators (Little's Law and Process Analysis).">

  <style>
    * { box-sizing: border-box; } /* IMPORTANT: prevents 100% width overflow */

    body { font-family: Arial, sans-serif; margin: 24px; line-height: 1.35; }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { margin-bottom: 8px; }
    .note { color: #444; margin-top: 0; }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    /* This prevents grids from overflowing/overlapping when content is wide */
    .grid > * { min-width: 0; }
    .grid.tight { grid-template-columns: minmax(0, 1fr) minmax(0, 1fr); }

    label { display: block; font-weight: 600; margin-bottom: 4px; }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      padding: 10px 14px;
      border: 1px solid #aaa;
      border-radius: 8px;
      background: #f7f7f7;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover { background: #eee; }

    .row { display: flex; gap: 10px; align-items: end; flex-wrap: wrap; }
    .result { font-size: 18px; font-weight: 700; padding: 10px; background: #fafafa; border: 1px dashed #bbb; border-radius: 8px; }
    .small { font-size: 13px; color: #555; }

    details.calc {
      border: 1px solid #ddd;
      border-radius: 10px;
      margin: 12px 0;
      background: #fff;
    }

    details.calc > summary {
      padding: 14px 16px;
      cursor: pointer;
      font-weight: 700;
      list-style: none;
      user-select: none;
    }

    details.calc > summary::-webkit-details-marker { display: none; }

    details.calc > summary::before {
      content: "▶";
      display: inline-block;
      width: 22px;
      margin-right: 6px;
      transform: translateY(-1px);
    }

    details.calc[open] > summary::before { content: "▼"; }

    details.calc .content { padding: 0 16px 16px 16px; }

    .section-title { margin: 12px 0 6px 0; }

    .input-with-unit {
      display: grid;
      grid-template-columns: minmax(0, 1fr) 150px; /* narrower unit column to avoid overlap */
      gap: 10px;
      align-items: end;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .footer {
      margin-top: 22px;
      padding-top: 12px;
      border-top: 1px solid #eee;
      color: #666;
      font-size: 12px;
      line-height: 1.4;
    }

    .tbl-wrap { overflow-x: auto; }
    table.tbl {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 10px;
      overflow: hidden;
    }
    .tbl th, .tbl td {
      padding: 10px 10px;
      border-bottom: 1px solid #f1f1f1;
      text-align: left;
      vertical-align: middle;
      overflow: hidden; /* prevents input spilling */
    }
    .tbl th { background: #fafafa; font-weight: 700; }
    .tbl tr:last-child td { border-bottom: none; }
    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #f2f2f2;
      border: 1px solid #e6e6e6;
      font-size: 12px;
      color: #555;
      margin-left: 6px;
    }

    /* Checkbox alignment */
    .checkline {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      margin-top: 10px;
    }
    .checkline input[type="checkbox"] {
      margin: 0;
      width: 18px;
      height: 18px;
      flex: 0 0 auto;
    }

    .card {
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 12px;
      background: #fff;
      margin-top: 10px;
    }

    @media (max-width: 700px) {
      .grid { grid-template-columns: 1fr; }
      .grid.tight { grid-template-columns: 1fr; }
      .input-with-unit { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>OTM 300 Calculators</h1>
    <p class="note">This page does not store data. Refreshing resets values.</p>

    <div class="row" style="margin: 12px 0 18px 0;">
      <button type="button" onclick="openAll()">Expand all</button>
      <button type="button" onclick="closeAll()">Collapse all</button>
      <button type="button" onclick="resetAll()">Reset all</button>
    </div>

    <!-- General Calculator -->
    <details class="calc" open>
      <summary>General Calculator (Exam-Safe)</summary>
      <div class="content">
        <p class="small">Basic arithmetic only: + − × ÷, parentheses, decimals.</p>

        <div style="max-width: 520px;">
          <label for="expr">Expression</label>
          <input id="expr" type="text" inputmode="decimal" placeholder="e.g., (12.5 + 3) / 4" />

          <div class="row" style="margin-top: 10px;">
            <button type="button" onclick="appendExpr('(')">(</button>
            <button type="button" onclick="appendExpr(')')">)</button>
            <button type="button" onclick="appendExpr('%')">%</button>
            <button type="button" onclick="backspaceExpr()">⌫</button>
            <button type="button" onclick="clearExpr()">AC</button>
          </div>

          <div class="grid" style="margin-top: 10px; grid-template-columns: repeat(4, 1fr);">
            <button type="button" onclick="appendExpr('7')">7</button>
            <button type="button" onclick="appendExpr('8')">8</button>
            <button type="button" onclick="appendExpr('9')">9</button>
            <button type="button" onclick="appendExpr('/')">÷</button>

            <button type="button" onclick="appendExpr('4')">4</button>
            <button type="button" onclick="appendExpr('5')">5</button>
            <button type="button" onclick="appendExpr('6')">6</button>
            <button type="button" onclick="appendExpr('*')">×</button>

            <button type="button" onclick="appendExpr('1')">1</button>
            <button type="button" onclick="appendExpr('2')">2</button>
            <button type="button" onclick="appendExpr('3')">3</button>
            <button type="button" onclick="appendExpr('-')">−</button>

            <button type="button" onclick="appendExpr('0')">0</button>
            <button type="button" onclick="appendExpr('.')">.</button>
            <button type="button" onclick="computeExpr()" style="font-weight:700;">=</button>
            <button type="button" onclick="appendExpr('+')">+</button>
          </div>

          <div style="margin-top: 12px;">
            <div class="small">Result</div>
            <div class="result" id="exprResult">-</div>
          </div>

          <p class="small" style="margin-top: 10px;">Tip: You can also type directly and press Enter.</p>
        </div>
      </div>
    </details>

    <!-- Chapter 2 -->
    <details class="calc">
      <summary>2. Intro to Operations</summary>
      <div class="content">
        <h3 class="section-title">Little’s Law</h3>

        <p class="small">
          Formula: <strong class="mono">I = R × T</strong>,
          where <strong>I</strong> is average inventory (flow units),
          <strong>R</strong> is average flow rate (flow units per time),
          and <strong>T</strong> is average flow time (time).
          Little’s Law describes <em>average</em> values.
        </p>

        <div class="row">
          <div style="flex: 1; min-width: 320px;">
            <label for="modeLittle">What do you want to solve for?</label>
            <select id="modeLittle" onchange="updateLittleUI()">
              <option value="solveI">Solve for I (given R and T)</option>
              <option value="solveT">Solve for T (given I and R)</option>
              <option value="solveR">Solve for R (given I and T)</option>
            </select>
          </div>

          <div style="flex: 1; min-width: 220px;">
            <label for="roundLittle">Rounding</label>
            <select id="roundLittle">
              <option value="none">No rounding</option>
              <option value="2">Round to 2 decimals</option>
              <option value="3">Round to 3 decimals</option>
              <option value="0">Round to whole number</option>
            </select>
          </div>

          <div id="outUnitWrap" style="flex: 1; min-width: 240px; display:none;">
            <label id="outUnitLabel" for="outUnit">Output units</label>
            <select id="outUnit"></select>
          </div>
        </div>

        <div class="grid" style="margin-top: 12px;">
          <div>
            <div class="input-with-unit">
              <div>
                <label id="xLabel" for="xInput">Flow rate, R</label>
                <input id="xInput" type="number" step="any" placeholder="e.g., 4">
              </div>
              <div>
                <label id="xUnitLabel" for="xUnit">Units</label>
                <select id="xUnit"></select>
              </div>
            </div>
          </div>

          <div>
            <div class="input-with-unit">
              <div>
                <label id="yLabel" for="yInput">Flow time, T</label>
                <input id="yInput" type="number" step="any" placeholder="e.g., 30">
              </div>
              <div>
                <label id="yUnitLabel" for="yUnit">Units</label>
                <select id="yUnit"></select>
              </div>
            </div>
          </div>
        </div>

        <div class="row" style="margin-top: 12px;">
          <button type="button" onclick="runLittle()">Compute</button>
          <button type="button" onclick="resetLittle()">Reset</button>
        </div>

        <div style="margin-top: 12px;">
          <div class="small">Result</div>
          <div class="result" id="littleResult">-</div>
          <div class="small" id="littleConversions" style="margin-top: 6px;"></div>
        </div>

        <p class="small" style="margin-top: 10px;">
          Tip: Use the unit dropdowns so the calculator handles time conversions.
        </p>
      </div>
    </details>

    <!-- Chapter 3 -->
    <details class="calc">
      <summary>3. Process Analysis</summary>
      <div class="content">

        <p class="small">
          <strong>Formulas:</strong><br>
          <span class="mono">capacity = m / processing time</span><br>
          <span class="mono">process capacity = min(capacityᵢ)</span><br>
          <span class="mono">flow rate = min(process capacity, demand rate)</span><br>
          <span class="mono">utilization = flow rate / capacity</span><br>
          <span class="mono">cycle time = 1 / flow rate</span><br>
          <span class="small">
            where <strong>m</strong> is the number of parallel servers, and processing time is <em>time per unit</em>.
          </span>
        </p>

        <div class="row" style="margin-top: 10px;">
          <div style="flex: 1; min-width: 220px;">
            <label for="roundCh3">Rounding</label>
            <select id="roundCh3">
              <option value="none">No rounding</option>
              <option value="2">Round to 2 decimals</option>
              <option value="3">Round to 3 decimals</option>
              <option value="0">Round to whole number</option>
            </select>
          </div>

          <div style="flex: 1; min-width: 260px;">
            <label for="outRateUnitCh3">Output rate units</label>
            <select id="outRateUnitCh3">
              <option value="per minute">flow units / minute</option>
              <option value="per hour" selected>flow units / hour</option>
              <option value="per day">flow units / day</option>
            </select>
          </div>

          <div style="flex: 1; min-width: 240px;">
            <label for="outTimeUnitCh3">Output cycle-time units</label>
            <select id="outTimeUnitCh3">
              <option value="seconds">seconds / unit</option>
              <option value="minutes" selected>minutes / unit</option>
              <option value="hours">hours / unit</option>
              <option value="days">days / unit</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top: 12px;">
          <button type="button" id="tabSingleBtn" onclick="setCh3Tab('single')" style="font-weight:700;">Single-step</button>
          <button type="button" id="tabMultiBtn" onclick="setCh3Tab('multi')">Multi-step</button>
          <button type="button" onclick="resetCh3()" style="margin-left:auto;">Reset</button>
        </div>

        <!-- SINGLE -->
        <div id="ch3TabSingle" style="margin-top: 12px;">
          <div class="grid tight" style="align-items:start;">
            <div>
              <h3 class="section-title">Inputs</h3>

              <label>Processing time (time per unit)</label>
              <div class="input-with-unit">
                <input id="pt1" type="number" step="any" placeholder="e.g., 2.5">
                <select id="pt1Unit">
                  <option value="seconds">seconds / unit</option>
                  <option value="minutes" selected>minutes / unit</option>
                  <option value="hours">hours / unit</option>
                  <option value="days">days / unit</option>
                </select>
              </div>

              <div class="grid tight" style="margin-top: 12px; grid-template-columns: 140px minmax(0, 1fr);">
                <div>
                  <label>Servers (m)</label>
                  <input id="m1" type="number" step="1" min="0" value="1">
                </div>
                <div>
                  <label>Demand rate</label>
                  <div class="input-with-unit">
                    <input id="demand1" type="number" step="any" placeholder="e.g., 30">
                    <select id="demand1Unit">
                      <option value="per minute">flow units / minute</option>
                      <option value="per hour" selected>flow units / hour</option>
                      <option value="per day">flow units / day</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="row" style="margin-top: 12px;">
                <button type="button" onclick="runCh3Single()">Compute</button>
              </div>

              <label class="checkline">
                <input type="checkbox" id="ch3ShowConvSingle" onchange="toggleCh3Conv('single')" />
                Show conversions
              </label>
            </div>

            <div>
              <h3 class="section-title">Outputs</h3>
              <div class="tbl-wrap">
                <table class="tbl">
                  <thead>
                    <tr>
                      <th>Metric</th>
                      <th>Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Capacity</td>
                      <td id="ch3SingleCapCell">-</td>
                    </tr>
                    <tr>
                      <td>Flow rate</td>
                      <td id="ch3SingleFlowCell">-</td>
                    </tr>
                    <tr>
                      <td>Utilization</td>
                      <td id="ch3SingleUtilCell">-</td>
                    </tr>
                    <tr>
                      <td>Cycle time</td>
                      <td id="ch3SingleCycleCell">-</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="small" id="ch3SingleConversions" style="margin-top:10px; display:none;"></div>
            </div>
          </div>
        </div>

        <!-- MULTI -->
        <div id="ch3TabMulti" style="margin-top: 12px; display:none;">
          <h3 class="section-title">Inputs</h3>
          <p class="small">Enter the steps you have (up to 4). Leave unused rows blank.</p>

          <div class="tbl-wrap">
            <table class="tbl">
              <thead>
                <tr>
                  <th style="width:70px;">Step</th>
                  <th>Processing time</th>
                  <th style="width:140px;">Unit</th>
                  <th style="width:110px;">m</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td><input id="ptS1" type="number" step="any" placeholder="e.g., 2"></td>
                  <td>
                    <select id="ptS1Unit">
                      <option value="seconds">sec/unit</option>
                      <option value="minutes" selected>min/unit</option>
                      <option value="hours">hr/unit</option>
                      <option value="days">day/unit</option>
                    </select>
                  </td>
                  <td><input id="mS1" type="number" step="1" min="0" value="1"></td>
                </tr>
                <tr>
                  <td>2</td>
                  <td><input id="ptS2" type="number" step="any" placeholder="e.g., 3"></td>
                  <td>
                    <select id="ptS2Unit">
                      <option value="seconds">sec/unit</option>
                      <option value="minutes" selected>min/unit</option>
                      <option value="hours">hr/unit</option>
                      <option value="days">day/unit</option>
                    </select>
                  </td>
                  <td><input id="mS2" type="number" step="1" min="0" value="1"></td>
                </tr>
                <tr>
                  <td>3</td>
                  <td><input id="ptS3" type="number" step="any" placeholder="e.g., 1.5"></td>
                  <td>
                    <select id="ptS3Unit">
                      <option value="seconds">sec/unit</option>
                      <option value="minutes" selected>min/unit</option>
                      <option value="hours">hr/unit</option>
                      <option value="days">day/unit</option>
                    </select>
                  </td>
                  <td><input id="mS3" type="number" step="1" min="0" value="1"></td>
                </tr>
                <tr>
                  <td>4</td>
                  <td><input id="ptS4" type="number" step="any" placeholder="e.g., 4"></td>
                  <td>
                    <select id="ptS4Unit">
                      <option value="seconds">sec/unit</option>
                      <option value="minutes" selected>min/unit</option>
                      <option value="hours">hr/unit</option>
                      <option value="days">day/unit</option>
                    </select>
                  </td>
                  <td><input id="mS4" type="number" step="1" min="0" value="1"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="grid tight" style="margin-top: 12px;">
            <div>
              <label>Demand rate</label>
              <div class="input-with-unit">
                <input id="demandS" type="number" step="any" placeholder="e.g., 20">
                <select id="demandSUnit">
                  <option value="per minute">flow units / minute</option>
                  <option value="per hour" selected>flow units / hour</option>
                  <option value="per day">flow units / day</option>
                </select>
              </div>
            </div>
            <div>
              <label>&nbsp;</label>
              <button type="button" onclick="runCh3Multi()">Compute</button>
            </div>
          </div>

          <h3 class="section-title" style="margin-top: 14px;">Outputs</h3>

          <div class="tbl-wrap">
            <table class="tbl">
              <thead>
                <tr>
                  <th>Metric</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Process capacity <span class="pill">(no step shown)</span></td>
                  <td id="ch3MultiProcCapCell">-</td>
                </tr>
                <tr>
                  <td>Flow rate</td>
                  <td id="ch3MultiFlowCell">-</td>
                </tr>
                <tr>
                  <td>Cycle time</td>
                  <td id="ch3MultiCycleCell">-</td>
                </tr>
              </tbody>
            </table>
          </div>

          <label class="checkline">
            <input type="checkbox" id="ch3ShowConvMulti" onchange="toggleCh3Conv('multi')" />
            Show conversions
          </label>

          <div class="small" id="ch3MultiConversions" style="margin-top:10px; display:none;"></div>

          <p class="small" style="margin-top:10px;">
            Note: Step-level metrics are intentionally not shown.
          </p>
        </div>
      </div>
    </details>

    <!-- Chapter 4 (NEW) -->
    <details class="calc">
      <summary>4. Process Improvement</summary>
      <div class="content">
        <p class="small">
          <strong>Formulas (as written in slides):</strong><br>
          <span class="mono">Labor Content = Sum of the processing times involving labor</span><br>
          <span class="mono">Cost of Direct Labor = (Wages per unit of time) / (Flow rate)</span><br>
          <span class="mono">Average Utilization = Labor Content / (Labor Content + Total Idle Time)</span><br>
          <span class="mono">Capacity (units/hour) = 3600 / time (seconds)</span><br>
          <span class="mono">Takt Time = 1 / (Demand Rate)</span><br>
          <span class="mono">Target Manpower = Labor Content / Takt Time</span><br>
          <span class="mono">Profit = (Flow_Rate * (Price - Variable_Cost)) - Fixed_Cost</span>
        </p>

        <div class="row" style="margin-top: 10px;">
          <div style="flex: 1; min-width: 220px;">
            <label for="roundCh4">Rounding</label>
            <select id="roundCh4">
              <option value="none">No rounding</option>
              <option value="2">Round to 2 decimals</option>
              <option value="3">Round to 3 decimals</option>
              <option value="0">Round to whole number</option>
            </select>
          </div>
          <div style="flex: 1; min-width: 260px;">
            <label for="outTimeUnitCh4">Output time units</label>
            <select id="outTimeUnitCh4">
              <option value="seconds" selected>seconds</option>
              <option value="minutes">minutes</option>
              <option value="hours">hours</option>
            </select>
          </div>
          <div style="flex: 1; min-width: 260px;">
            <label for="outRateUnitCh4">Output rate units</label>
            <select id="outRateUnitCh4">
              <option value="per minute">flow units / minute</option>
              <option value="per hour" selected>flow units / hour</option>
              <option value="per day">flow units / day</option>
            </select>
          </div>
          <button type="button" onclick="resetCh4()" style="margin-left:auto;">Reset</button>
        </div>

        <!-- Labor Content -->
        <div class="card">
          <h3 class="section-title">Labor Content (LC)</h3>
          <p class="small">Enter station processing times (time per unit). Leave unused rows blank.</p>

          <div class="tbl-wrap">
            <table class="tbl">
              <thead>
                <tr>
                  <th style="width:80px;">Station</th>
                  <th>Time</th>
                  <th style="width:160px;">Unit</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td><input id="ch4LC1" type="number" step="any" placeholder="e.g., 37"></td>
                  <td>
                    <select id="ch4LC1Unit">
                      <option value="seconds" selected>seconds</option>
                      <option value="minutes">minutes</option>
                      <option value="hours">hours</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>2</td>
                  <td><input id="ch4LC2" type="number" step="any" placeholder="e.g., 46"></td>
                  <td>
                    <select id="ch4LC2Unit">
                      <option value="seconds" selected>seconds</option>
                      <option value="minutes">minutes</option>
                      <option value="hours">hours</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>3</td>
                  <td><input id="ch4LC3" type="number" step="any" placeholder="e.g., 37"></td>
                  <td>
                    <select id="ch4LC3Unit">
                      <option value="seconds" selected>seconds</option>
                      <option value="minutes">minutes</option>
                      <option value="hours">hours</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>4</td>
                  <td><input id="ch4LC4" type="number" step="any" placeholder=""></td>
                  <td>
                    <select id="ch4LC4Unit">
                      <option value="seconds" selected>seconds</option>
                      <option value="minutes">minutes</option>
                      <option value="hours">hours</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>5</td>
                  <td><input id="ch4LC5" type="number" step="any" placeholder=""></td>
                  <td>
                    <select id="ch4LC5Unit">
                      <option value="seconds" selected>seconds</option>
                      <option value="minutes">minutes</option>
                      <option value="hours">hours</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>6</td>
                  <td><input id="ch4LC6" type="number" step="any" placeholder=""></td>
                  <td>
                    <select id="ch4LC6Unit">
                      <option value="seconds" selected>seconds</option>
                      <option value="minutes">minutes</option>
                      <option value="hours">hours</option>
                    </select>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh4LC()">Compute LC</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Result</div>
            <div class="result" id="ch4LCResult">-</div>
            <div class="small" id="ch4LCConv" style="margin-top: 6px;"></div>
          </div>
        </div>

        <!-- CDL -->
        <div class="card">
          <h3 class="section-title">Cost of Direct Labor (CDL)</h3>
          <p class="small">Formula: <span class="mono">CDL = (Wages per unit of time) / (Flow rate)</span></p>

          <div class="grid" style="margin-top: 12px;">
            <div>
              <label>Total wages per unit of time</label>
              <div class="input-with-unit">
                <input id="ch4Wages" type="number" step="any" placeholder="e.g., 36">
                <select id="ch4WagesUnit">
                  <option value="per hour" selected>$ / hour</option>
                  <option value="per minute">$ / minute</option>
                  <option value="per day">$ / day</option>
                </select>
              </div>
            </div>
            <div>
              <label>Flow rate</label>
              <div class="input-with-unit">
                <input id="ch4Flow" type="number" step="any" placeholder="e.g., 78.3">
                <select id="ch4FlowUnit">
                  <option value="per hour" selected>units / hour</option>
                  <option value="per minute">units / minute</option>
                  <option value="per day">units / day</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh4CDL()">Compute CDL</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Result</div>
            <div class="result" id="ch4CDLResult">-</div>
            <div class="small" id="ch4CDLConv" style="margin-top: 6px;"></div>
          </div>
        </div>

        <!-- Average Utilization -->
        <div class="card">
          <h3 class="section-title">Average Labor Utilization (AU)</h3>
          <p class="small">Formula: <span class="mono">AU = LC / (LC + Total Idle Time)</span></p>

          <div class="grid" style="margin-top: 12px;">
            <div>
              <label>Labor Content (LC)</label>
              <div class="input-with-unit">
                <input id="ch4AU_LC" type="number" step="any" placeholder="e.g., 120">
                <select id="ch4AU_LC_Unit">
                  <option value="seconds" selected>seconds</option>
                  <option value="minutes">minutes</option>
                  <option value="hours">hours</option>
                </select>
              </div>
            </div>
            <div>
              <label>Total Idle Time</label>
              <div class="input-with-unit">
                <input id="ch4AU_Idle" type="number" step="any" placeholder="e.g., 18">
                <select id="ch4AU_Idle_Unit">
                  <option value="seconds" selected>seconds</option>
                  <option value="minutes">minutes</option>
                  <option value="hours">hours</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh4AU()">Compute AU</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Result</div>
            <div class="result" id="ch4AUResult">-</div>
            <div class="small" id="ch4AUConv" style="margin-top: 6px;"></div>
          </div>
        </div>

        <!-- Takt + Target Manpower -->
        <div class="card">
          <h3 class="section-title">Takt Time + Target Manpower</h3>
          <p class="small">
            Formulas: <span class="mono">Takt Time = 1 / (Demand Rate)</span> and
            <span class="mono">Target Manpower = LC / Takt Time</span>
          </p>

          <div class="grid" style="margin-top: 12px;">
            <div>
              <label>Demand rate</label>
              <div class="input-with-unit">
                <input id="ch4Demand" type="number" step="any" placeholder="e.g., 160">
                <select id="ch4DemandUnit">
                  <option value="per hour" selected>units / hour</option>
                  <option value="per minute">units / minute</option>
                  <option value="per day">units / day</option>
                </select>
              </div>
            </div>
            <div>
              <label>Labor Content (LC)</label>
              <div class="input-with-unit">
                <input id="ch4TM_LC" type="number" step="any" placeholder="e.g., 120">
                <select id="ch4TM_LC_Unit">
                  <option value="seconds" selected>seconds</option>
                  <option value="minutes">minutes</option>
                  <option value="hours">hours</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh4TaktAndTM()">Compute</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Results</div>
            <div class="result" id="ch4TaktResult">-</div>
            <div class="result" id="ch4TMResult" style="margin-top:10px;">-</div>
            <div class="small" id="ch4TaktTMConv" style="margin-top: 6px;"></div>
          </div>
        </div>

        <!-- Profit -->
        <div class="card">
          <h3 class="section-title">Profit</h3>
          <p class="small">Formula: <span class="mono">Profit = (Flow Rate * (Price - Variable Cost)) - Fixed Cost</span></p>

          <div class="grid" style="margin-top: 12px;">
            <div>
              <label>Flow rate</label>
              <div class="input-with-unit">
                <input id="ch4P_Flow" type="number" step="any" placeholder="e.g., 76.6">
                <select id="ch4P_FlowUnit">
                  <option value="per hour" selected>units / hour</option>
                  <option value="per minute">units / minute</option>
                  <option value="per day">units / day</option>
                </select>
              </div>
            </div>
            <div>
              <label>Fixed cost (same time basis as flow rate)</label>
              <div class="input-with-unit">
                <input id="ch4P_Fixed" type="number" step="any" placeholder="e.g., 250">
                <select id="ch4P_FixedUnit">
                  <option value="per hour" selected>$ / hour</option>
                  <option value="per minute">$ / minute</option>
                  <option value="per day">$ / day</option>
                </select>
              </div>
            </div>
          </div>

          <div class="grid" style="margin-top: 12px;">
            <div>
              <label>Price ($/unit)</label>
              <input id="ch4P_Price" type="number" step="any" placeholder="e.g., 6">
            </div>
            <div>
              <label>Variable cost ($/unit)</label>
              <input id="ch4P_VC" type="number" step="any" placeholder="e.g., 1.5">
            </div>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh4Profit()">Compute Profit</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Result</div>
            <div class="result" id="ch4ProfitResult">-</div>
            <div class="small" id="ch4ProfitConv" style="margin-top: 6px;"></div>
          </div>
        </div>
      </div>
    </details>

    <!-- Chapter 5 (NEW) -->
    <details class="calc">
      <summary>5. Complex Process Flows</summary>
      <div class="content">
        <p class="small">
          <strong>Formulas (as written in slides):</strong><br>
          <span class="mono">Implied Utilization = Demand / Capacity</span><br>
          <span class="mono">Yield = Successful Output / Input</span><br>
          <span class="mono">Input Required = Needed Output / Yield</span><br>
          <span class="mono">Workload Share (minutes per 100 apps) = Volume * Time</span><br>
          <span class="mono">Total Workload = SUMPRODUCT(Volume_Range, Time_Range)</span><br>
          <span class="mono">Actual Workload = Standard Time + Extra Rework Time</span>
        </p>

        <div class="row" style="margin-top: 10px;">
          <div style="flex: 1; min-width: 220px;">
            <label for="roundCh5">Rounding</label>
            <select id="roundCh5">
              <option value="none">No rounding</option>
              <option value="2">Round to 2 decimals</option>
              <option value="3">Round to 3 decimals</option>
              <option value="0">Round to whole number</option>
            </select>
          </div>
          <button type="button" onclick="resetCh5()" style="margin-left:auto;">Reset</button>
        </div>

        <!-- Implied Utilization -->
        <div class="card">
          <h3 class="section-title">Implied Utilization (IU)</h3>
          <p class="small">Formula: <span class="mono">IU = Demand / Capacity</span></p>

          <div class="grid" style="margin-top: 12px;">
            <div>
              <label>Demand</label>
              <div class="input-with-unit">
                <input id="ch5Demand" type="number" step="any" placeholder="e.g., 300">
                <select id="ch5RateUnitA">
                  <option value="per hour" selected>units / hour</option>
                  <option value="per day">units / day</option>
                  <option value="per minute">units / minute</option>
                </select>
              </div>
            </div>
            <div>
              <label>Capacity</label>
              <div class="input-with-unit">
                <input id="ch5Cap" type="number" step="any" placeholder="e.g., 250">
                <select id="ch5RateUnitB">
                  <option value="per hour" selected>units / hour</option>
                  <option value="per day">units / day</option>
                  <option value="per minute">units / minute</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh5IU()">Compute IU</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Result</div>
            <div class="result" id="ch5IUResult">-</div>
            <div class="small" id="ch5IUConv" style="margin-top: 6px;"></div>
          </div>
        </div>

        <!-- Yield -->
        <div class="card">
          <h3 class="section-title">Yield</h3>
          <p class="small">Formula: <span class="mono">Yield = Successful Output / Input</span></p>

          <div class="grid" style="margin-top: 12px;">
            <div>
              <label>Successful output</label>
              <input id="ch5Succ" type="number" step="any" placeholder="e.g., 90">
            </div>
            <div>
              <label>Input</label>
              <input id="ch5Input" type="number" step="any" placeholder="e.g., 100">
            </div>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh5Yield()">Compute Yield</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Result</div>
            <div class="result" id="ch5YieldResult">-</div>
          </div>
        </div>

        <!-- Required Input -->
        <div class="card">
          <h3 class="section-title">Required Input</h3>
          <p class="small">Formula: <span class="mono">Input Required = Needed Output / Yield</span></p>

          <div class="grid" style="margin-top: 12px;">
            <div>
              <label>Needed output</label>
              <input id="ch5NeedOut" type="number" step="any" placeholder="e.g., 100">
            </div>
            <div>
              <label>Yield (decimal)</label>
              <input id="ch5YieldDec" type="number" step="any" placeholder="e.g., 0.80">
            </div>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh5ReqInput()">Compute Input Required</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Result</div>
            <div class="result" id="ch5ReqInputResult">-</div>
            <div class="small" id="ch5ReqNote" style="margin-top: 6px;"></div>
          </div>
        </div>

        <!-- Workload Translation -->
        <div class="card">
          <h3 class="section-title">Workload Translation (SUMPRODUCT)</h3>
          <p class="small">
            Formulas: <span class="mono">Workload Share = Volume * Time</span> and
            <span class="mono">Total Workload = SUMPRODUCT(Volume, Time)</span>
          </p>
          <p class="small">Enter up to 5 types. Volume can be “# units” (e.g., per 100 apps) or any consistent count.</p>

          <div class="tbl-wrap">
            <table class="tbl">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Volume</th>
                  <th>Time per unit (minutes)</th>
                  <th>Workload share (minutes)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><input id="ch5Type1" type="text" placeholder="e.g., Simple"></td>
                  <td><input id="ch5Vol1" type="number" step="any" placeholder="e.g., 60"></td>
                  <td><input id="ch5Time1" type="number" step="any" placeholder="e.g., 10"></td>
                  <td id="ch5Share1">-</td>
                </tr>
                <tr>
                  <td><input id="ch5Type2" type="text" placeholder="e.g., Medium"></td>
                  <td><input id="ch5Vol2" type="number" step="any" placeholder="e.g., 30"></td>
                  <td><input id="ch5Time2" type="number" step="any" placeholder="e.g., 25"></td>
                  <td id="ch5Share2">-</td>
                </tr>
                <tr>
                  <td><input id="ch5Type3" type="text" placeholder="e.g., Complex"></td>
                  <td><input id="ch5Vol3" type="number" step="any" placeholder="e.g., 10"></td>
                  <td><input id="ch5Time3" type="number" step="any" placeholder="e.g., 40"></td>
                  <td id="ch5Share3">-</td>
                </tr>
                <tr>
                  <td><input id="ch5Type4" type="text" placeholder=""></td>
                  <td><input id="ch5Vol4" type="number" step="any" placeholder=""></td>
                  <td><input id="ch5Time4" type="number" step="any" placeholder=""></td>
                  <td id="ch5Share4">-</td>
                </tr>
                <tr>
                  <td><input id="ch5Type5" type="text" placeholder=""></td>
                  <td><input id="ch5Vol5" type="number" step="any" placeholder=""></td>
                  <td><input id="ch5Time5" type="number" step="any" placeholder=""></td>
                  <td id="ch5Share5">-</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh5Workload()">Compute Workload</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Total workload</div>
            <div class="result" id="ch5WorkloadTotal">-</div>
          </div>
        </div>

        <!-- Rework -->
        <div class="card">
          <h3 class="section-title">Rework: Actual Workload</h3>
          <p class="small">Formula: <span class="mono">Actual Workload = Standard Time + Extra Rework Time</span></p>

          <div class="grid" style="margin-top: 12px;">
            <div>
              <label>Standard time</label>
              <div class="input-with-unit">
                <input id="ch5StdTime" type="number" step="any" placeholder="e.g., 3">
                <select id="ch5StdUnit">
                  <option value="hours" selected>hours</option>
                  <option value="minutes">minutes</option>
                  <option value="seconds">seconds</option>
                </select>
              </div>
            </div>
            <div>
              <label>Extra rework time</label>
              <div class="input-with-unit">
                <input id="ch5ReworkTime" type="number" step="any" placeholder="e.g., 2">
                <select id="ch5ReworkUnit">
                  <option value="hours" selected>hours</option>
                  <option value="minutes">minutes</option>
                  <option value="seconds">seconds</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top: 12px;">
            <button type="button" onclick="runCh5Rework()">Compute Actual Workload</button>
          </div>

          <div style="margin-top: 10px;">
            <div class="small">Result</div>
            <div class="result" id="ch5ReworkResult">-</div>
            <div class="small" id="ch5ReworkConv" style="margin-top: 6px;"></div>
          </div>
        </div>
      </div>
    </details>

    <div class="footer">
      <div>© 2026 Amir Fard Bahreini. All rights reserved.</div>
      <div>These course materials may not be reproduced, distributed, recorded, or shared without permission.</div>
    </div>
  </div>

<script>
  /* -------- Helpers -------- */
  function parseNum(id) {
    const v = document.getElementById(id).value;
    if (v === "" || v === null) return null;
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  }

  function formatResult(value, roundSelectId) {
    const roundEl = document.getElementById(roundSelectId);
    const roundMode = roundEl ? roundEl.value : "none";
    if (roundMode === "none") return String(value);

    const decimals = Number(roundMode);
    if (!Number.isFinite(decimals)) return String(value);

    return value.toFixed(decimals);
  }

  function setText(id, txt) { document.getElementById(id).textContent = txt; }
  function clearText(id) { document.getElementById(id).textContent = ""; }

  function isNonNegative(n) {
    return typeof n === "number" && Number.isFinite(n) && n >= 0;
  }

  function fillSelect(selectEl, options) {
    selectEl.innerHTML = "";
    for (const opt of options) {
      const o = document.createElement("option");
      o.value = opt.value;
      o.textContent = opt.label;
      selectEl.appendChild(o);
    }
  }

  /* -------- Expand/Collapse Controls -------- */
  function openAll() {
    document.querySelectorAll("details.calc").forEach(d => d.open = true);
  }
  function closeAll() {
    document.querySelectorAll("details.calc").forEach(d => d.open = false);
  }
  function resetAll() {
    clearExpr();
    resetLittle();
    resetCh3();
    resetCh4();
    resetCh5();
  }

  /* -------- General Calculator (Exam-Safe) -------- */
  function appendExpr(s) {
    const el = document.getElementById("expr");
    el.value = (el.value || "") + s;
    el.focus();
  }

  function backspaceExpr() {
    const el = document.getElementById("expr");
    el.value = (el.value || "").slice(0, -1);
    el.focus();
  }

  function clearExpr() {
    document.getElementById("expr").value = "";
    document.getElementById("exprResult").textContent = "-";
  }

  function computeExpr() {
    const raw = (document.getElementById("expr").value || "").trim();
    if (!raw) {
      document.getElementById("exprResult").textContent = "Enter an expression.";
      return;
    }

    if (!/^[0-9+\-*/().%\s]+$/.test(raw)) {
      document.getElementById("exprResult").textContent = "Invalid characters.";
      return;
    }

    const transformed = raw.replace(/(\d+(\.\d+)?)\s*%/g, "($1/100)");

    try {
      // eslint-disable-next-line no-new-func
      const val = Function(`"use strict"; return (${transformed});`)();
      if (!Number.isFinite(val)) {
        document.getElementById("exprResult").textContent = "Result undefined.";
        return;
      }
      document.getElementById("exprResult").textContent = String(val);
    } catch (e) {
      document.getElementById("exprResult").textContent = "Check your expression.";
    }
  }

  document.addEventListener("keydown", (e) => {
    const active = document.activeElement;
    if (active && active.id === "expr" && e.key === "Enter") {
      e.preventDefault();
      computeExpr();
    }
  });

  /* -------- Little’s Law -------- */

  // Base time unit: hour
  const TIME_TO_HOURS = {
    "seconds": 1 / 3600,
    "minutes": 1 / 60,
    "hours": 1,
    "days": 24
  };

  // Convert a rate "per X" into "per hour"
  const RATE_TO_PER_HOUR = {
    "per second": 3600,
    "per minute": 60,
    "per hour": 1,
    "per day": 1 / 24
  };

  function setUnitModeForSolveI() {
    const xUnit = document.getElementById("xUnit");
    const yUnit = document.getElementById("yUnit");

    fillSelect(xUnit, [
      { value: "per hour", label: "flow units per hour" },
      { value: "per minute", label: "flow units per minute" },
      { value: "per day", label: "flow units per day" }
    ]);

    fillSelect(yUnit, [
      { value: "seconds", label: "seconds" },
      { value: "minutes", label: "minutes" },
      { value: "hours", label: "hours" },
      { value: "days", label: "days" }
    ]);

    xUnit.value = "per hour";
    yUnit.value = "hours";

    document.getElementById("xUnitLabel").textContent = "Rate units";
    document.getElementById("yUnitLabel").textContent = "Time units";
  }

  function setUnitModeForSolveT() {
    const xUnit = document.getElementById("xUnit");
    const yUnit = document.getElementById("yUnit");

    fillSelect(xUnit, [
      { value: "flow units", label: "flow units" }
    ]);

    fillSelect(yUnit, [
      { value: "per hour", label: "flow units per hour" },
      { value: "per minute", label: "flow units per minute" },
      { value: "per day", label: "flow units per day" }
    ]);

    xUnit.value = "flow units";
    yUnit.value = "per hour";

    document.getElementById("xUnitLabel").textContent = "Inventory units";
    document.getElementById("yUnitLabel").textContent = "Rate units";
  }

  function setUnitModeForSolveR() {
    const xUnit = document.getElementById("xUnit");
    const yUnit = document.getElementById("yUnit");

    fillSelect(xUnit, [
      { value: "flow units", label: "flow units" }
    ]);

    fillSelect(yUnit, [
      { value: "seconds", label: "seconds" },
      { value: "minutes", label: "minutes" },
      { value: "hours", label: "hours" },
      { value: "days", label: "days" }
    ]);

    xUnit.value = "flow units";
    yUnit.value = "hours";

    document.getElementById("xUnitLabel").textContent = "Inventory units";
    document.getElementById("yUnitLabel").textContent = "Time units";
  }

  function setOutputUnitMode(mode) {
    const wrap = document.getElementById("outUnitWrap");
    const outUnitLabel = document.getElementById("outUnitLabel");
    const outUnit = document.getElementById("outUnit");

    if (mode === "solveI") {
      wrap.style.display = "none";
      outUnit.innerHTML = "";
      return;
    }

    wrap.style.display = "block";

    if (mode === "solveT") {
      outUnitLabel.textContent = "Output time units";
      fillSelect(outUnit, [
        { value: "seconds", label: "seconds" },
        { value: "minutes", label: "minutes" },
        { value: "hours", label: "hours" },
        { value: "days", label: "days" }
      ]);
      outUnit.value = "hours";
      return;
    }

    if (mode === "solveR") {
      outUnitLabel.textContent = "Output rate units";
      fillSelect(outUnit, [
        { value: "per minute", label: "flow units per minute" },
        { value: "per hour", label: "flow units per hour" },
        { value: "per day", label: "flow units per day" }
      ]);
      outUnit.value = "per hour";
      return;
    }
  }

  function updateLittleUI() {
    const mode = document.getElementById("modeLittle").value;

    const xLabel = document.getElementById("xLabel");
    const yLabel = document.getElementById("yLabel");
    const xInput = document.getElementById("xInput");
    const yInput = document.getElementById("yInput");

    xInput.value = "";
    yInput.value = "";
    setText("littleResult", "-");
    clearText("littleConversions");

    setOutputUnitMode(mode);

    if (mode === "solveI") {
      xLabel.textContent = "Flow rate, R";
      yLabel.textContent = "Flow time, T";
      xInput.placeholder = "e.g., 4";
      yInput.placeholder = "e.g., 30";
      setUnitModeForSolveI();
    }

    if (mode === "solveT") {
      xLabel.textContent = "Inventory, I (average inventory in system)";
      yLabel.textContent = "Flow rate, R";
      xInput.placeholder = "e.g., 200";
      yInput.placeholder = "e.g., 4";
      setUnitModeForSolveT();
    }

    if (mode === "solveR") {
      xLabel.textContent = "Inventory, I (average inventory in system)";
      yLabel.textContent = "Flow time, T";
      xInput.placeholder = "e.g., 200";
      yInput.placeholder = "e.g., 2";
      setUnitModeForSolveR();
    }
  }

  function runLittle() {
    const mode = document.getElementById("modeLittle").value;
    const x = parseNum("xInput");
    const y = parseNum("yInput");

    if (x === null || y === null) {
      setText("littleResult", "Enter both inputs.");
      clearText("littleConversions");
      return;
    }

    if (!isNonNegative(x) || !isNonNegative(y)) {
      setText("littleResult", "Inputs must be non-negative numbers.");
      clearText("littleConversions");
      return;
    }

    const xUnit = document.getElementById("xUnit").value;
    const yUnit = document.getElementById("yUnit").value;
    const outUnit = document.getElementById("outUnit").value;

    let conversionsNote = "";

    if (mode === "solveI") {
      const R_per_hour = x * (RATE_TO_PER_HOUR[xUnit] ?? 1);
      const T_hours = y * (TIME_TO_HOURS[yUnit] ?? 1);

      const I = R_per_hour * T_hours;

      const shown = formatResult(I, "roundLittle");
      setText("littleResult", "I = " + shown + " flow units");
      conversionsNote = `Converted to base units: R = ${R_per_hour} flow units/hour, T = ${T_hours} hours.`;
      setText("littleConversions", conversionsNote);
      return;
    }

    if (mode === "solveT") {
      const I = x;
      const R_per_hour = y * (RATE_TO_PER_HOUR[yUnit] ?? 1);

      if (R_per_hour === 0) {
        setText("littleResult", "Flow rate R must be > 0.");
        clearText("littleConversions");
        return;
      }

      const T_hours = I / R_per_hour;

      const factor = TIME_TO_HOURS[outUnit] ?? 1;
      const T_out = T_hours / factor;

      const shown = formatResult(T_out, "roundLittle");
      setText("littleResult", "T = " + shown + " " + outUnit);
      conversionsNote = `Converted to base units: R = ${R_per_hour} flow units/hour, so T = ${T_hours} hours.`;
      setText("littleConversions", conversionsNote);
      return;
    }

    if (mode === "solveR") {
      const I = x;
      const T_hours = y * (TIME_TO_HOURS[yUnit] ?? 1);

      if (T_hours === 0) {
        setText("littleResult", "Flow time T must be > 0.");
        clearText("littleConversions");
        return;
      }

      const R_per_hour = I / T_hours;

      const perHourFactor = RATE_TO_PER_HOUR[outUnit] ?? 1;
      const R_out = R_per_hour / perHourFactor;

      let label = "flow units/hour";
      if (outUnit === "per minute") label = "flow units/minute";
      if (outUnit === "per day") label = "flow units/day";

      const shown = formatResult(R_out, "roundLittle");
      setText("littleResult", "R = " + shown + " " + label);
      conversionsNote = `Converted to base units: T = ${T_hours} hours, so R = ${R_per_hour} flow units/hour.`;
      setText("littleConversions", conversionsNote);
      return;
    }
  }

  function resetLittle() {
    document.getElementById("modeLittle").value = "solveI";
    document.getElementById("roundLittle").value = "none";
    updateLittleUI();
  }

  /* -------- Chapter 3: Process Analysis (bottleneck-safe outputs) -------- */

  function setCh3Tab(which) {
    const single = document.getElementById("ch3TabSingle");
    const multi = document.getElementById("ch3TabMulti");
    const b1 = document.getElementById("tabSingleBtn");
    const b2 = document.getElementById("tabMultiBtn");

    if (which === "multi") {
      single.style.display = "none";
      multi.style.display = "block";
      b1.style.fontWeight = "400";
      b2.style.fontWeight = "700";
    } else {
      single.style.display = "block";
      multi.style.display = "none";
      b1.style.fontWeight = "700";
      b2.style.fontWeight = "400";
    }
  }

  function toggleCh3Conv(which) {
    if (which === "multi") {
      const show = document.getElementById("ch3ShowConvMulti").checked;
      document.getElementById("ch3MultiConversions").style.display = show ? "block" : "none";
    } else {
      const show = document.getElementById("ch3ShowConvSingle").checked;
      document.getElementById("ch3SingleConversions").style.display = show ? "block" : "none";
    }
  }

  function rateLabelFromUnit(outUnit) {
    if (outUnit === "per minute") return "flow units/minute";
    if (outUnit === "per day") return "flow units/day";
    return "flow units/hour";
  }

  function toPerHour(value, perUnit) {
    return value * (RATE_TO_PER_HOUR[perUnit] ?? 1);
  }

  function fromPerHour(valuePerHour, outPerUnit) {
    const factor = RATE_TO_PER_HOUR[outPerUnit] ?? 1;
    return valuePerHour / factor;
  }

  function cycleTimeOutFromHoursPerUnit(hoursPerUnit, outTimeUnit) {
    const factor = TIME_TO_HOURS[outTimeUnit] ?? 1;
    return hoursPerUnit / factor;
  }

  function safeNonNegOrDefault(n, defVal) {
    if (n === null || n === undefined || n === "") return defVal;
    const x = Number(n);
    if (!Number.isFinite(x) || x < 0) return defVal;
    return x;
  }

  function computeCapacityPerHour(processTimeVal, processTimeUnit, mVal) {
    const pt_hours_per_unit = processTimeVal * (TIME_TO_HOURS[processTimeUnit] ?? 1);
    if (pt_hours_per_unit <= 0) return null;
    const m = safeNonNegOrDefault(mVal, 1);
    return m / pt_hours_per_unit; // units/hour
  }

  function setCell(id, txt) {
    const el = document.getElementById(id);
    if (el) el.textContent = txt;
  }

  function runCh3Single() {
    const pt = parseNum("pt1");
    const demand = parseNum("demand1");
    const m = parseNum("m1");

    if (pt === null || demand === null) {
      setCell("ch3SingleCapCell", "Enter processing time and demand rate.");
      setCell("ch3SingleFlowCell", "-");
      setCell("ch3SingleUtilCell", "-");
      setCell("ch3SingleCycleCell", "-");
      clearText("ch3SingleConversions");
      return;
    }
    if (!isNonNegative(pt) || !isNonNegative(demand)) {
      setCell("ch3SingleCapCell", "Inputs must be non-negative.");
      return;
    }

    const ptUnit = document.getElementById("pt1Unit").value;
    const demandUnit = document.getElementById("demand1Unit").value;
    const outRateUnit = document.getElementById("outRateUnitCh3").value;
    const outTimeUnit = document.getElementById("outTimeUnitCh3").value;

    const cap_per_hour = computeCapacityPerHour(pt, ptUnit, m);
    if (cap_per_hour === null) {
      setCell("ch3SingleCapCell", "Processing time must be > 0.");
      return;
    }

    const demand_per_hour = toPerHour(demand, demandUnit);
    const flow_per_hour = Math.min(cap_per_hour, demand_per_hour);

    const util = cap_per_hour === 0 ? 0 : (flow_per_hour / cap_per_hour);
    const cycle_hours_per_unit = flow_per_hour === 0 ? Infinity : (1 / flow_per_hour);

    const cap_out_raw = fromPerHour(cap_per_hour, outRateUnit);
    const flow_out_raw = fromPerHour(flow_per_hour, outRateUnit);
    const cycle_out_raw = cycleTimeOutFromHoursPerUnit(cycle_hours_per_unit, outTimeUnit);

    const cap_out = formatResult(cap_out_raw, "roundCh3");
    const flow_out = formatResult(flow_out_raw, "roundCh3");
    const util_out = (cycle_hours_per_unit === Infinity) ? "N/A" : formatResult(util, "roundCh3");
    const cycle_out = (cycle_hours_per_unit === Infinity) ? "N/A" : formatResult(cycle_out_raw, "roundCh3");

    const rateLabel = rateLabelFromUnit(outRateUnit);

    setCell("ch3SingleCapCell", `${cap_out} ${rateLabel}`);
    setCell("ch3SingleFlowCell", `${flow_out} ${rateLabel}`);
    setCell("ch3SingleUtilCell", `${util_out}`);
    setCell("ch3SingleCycleCell", `${cycle_out} ${outTimeUnit}`);

    setText(
      "ch3SingleConversions",
      `Base units: capacity=${cap_per_hour} flow units/hour, demand=${demand_per_hour} flow units/hour, flow rate=${flow_per_hour} flow units/hour.`
    );
  }

  function readStepCapPerHour(stepIdx) {
    const ptId = `ptS${stepIdx}`;
    const unitId = `ptS${stepIdx}Unit`;
    const mId = `mS${stepIdx}`;

    const pt = parseNum(ptId);
    if (pt === null) return null;

    if (!isNonNegative(pt)) return { error: "Processing times must be non-negative." };

    const unit = document.getElementById(unitId).value;
    const m = parseNum(mId);

    const cap_per_hour = computeCapacityPerHour(pt, unit, m);
    if (cap_per_hour === null) return { error: "Processing time must be > 0 for entered steps." };

    return { cap_per_hour };
  }

  function runCh3Multi() {
    const demand = parseNum("demandS");
    if (demand === null) {
      setCell("ch3MultiProcCapCell", "Enter demand rate.");
      setCell("ch3MultiFlowCell", "-");
      setCell("ch3MultiCycleCell", "-");
      clearText("ch3MultiConversions");
      return;
    }
    if (!isNonNegative(demand)) {
      setCell("ch3MultiProcCapCell", "Demand must be non-negative.");
      return;
    }

    const demandUnit = document.getElementById("demandSUnit").value;
    const outRateUnit = document.getElementById("outRateUnitCh3").value;
    const outTimeUnit = document.getElementById("outTimeUnitCh3").value;

    const caps = [];
    for (let i = 1; i <= 4; i++) {
      const s = readStepCapPerHour(i);
      if (s && s.error) {
        setCell("ch3MultiProcCapCell", s.error);
        setCell("ch3MultiFlowCell", "-");
        setCell("ch3MultiCycleCell", "-");
        clearText("ch3MultiConversions");
        return;
      }
      if (s) caps.push(s.cap_per_hour);
    }

    if (caps.length === 0) {
      setCell("ch3MultiProcCapCell", "Enter at least one step.");
      setCell("ch3MultiFlowCell", "-");
      setCell("ch3MultiCycleCell", "-");
      clearText("ch3MultiConversions");
      return;
    }

    const processCap_per_hour = Math.min(...caps);
    const demand_per_hour = toPerHour(demand, demandUnit);
    const flow_per_hour = Math.min(processCap_per_hour, demand_per_hour);
    const cycle_hours_per_unit = flow_per_hour === 0 ? Infinity : (1 / flow_per_hour);

    const rateLabel = rateLabelFromUnit(outRateUnit);

    const procCap_out = formatResult(fromPerHour(processCap_per_hour, outRateUnit), "roundCh3");
    const flow_out = formatResult(fromPerHour(flow_per_hour, outRateUnit), "roundCh3");
    const cycle_out = (cycle_hours_per_unit === Infinity)
      ? "N/A"
      : formatResult(cycleTimeOutFromHoursPerUnit(cycle_hours_per_unit, outTimeUnit), "roundCh3");

    setCell("ch3MultiProcCapCell", `${procCap_out} ${rateLabel}`);
    setCell("ch3MultiFlowCell", `${flow_out} ${rateLabel}`);
    setCell("ch3MultiCycleCell", `${cycle_out} ${outTimeUnit}`);

    setText(
      "ch3MultiConversions",
      `Base units: process capacity=${processCap_per_hour} flow units/hour, demand=${demand_per_hour} flow units/hour, flow rate=${flow_per_hour} flow units/hour.`
    );
  }

  function resetCh3() {
    setCh3Tab("single");

    document.getElementById("roundCh3").value = "none";
    document.getElementById("outRateUnitCh3").value = "per hour";
    document.getElementById("outTimeUnitCh3").value = "minutes";

    document.getElementById("ch3ShowConvSingle").checked = false;
    document.getElementById("ch3ShowConvMulti").checked = false;
    toggleCh3Conv("single");
    toggleCh3Conv("multi");

    document.getElementById("pt1").value = "";
    document.getElementById("pt1Unit").value = "minutes";
    document.getElementById("m1").value = "1";
    document.getElementById("demand1").value = "";
    document.getElementById("demand1Unit").value = "per hour";

    for (let i = 1; i <= 4; i++) {
      document.getElementById(`ptS${i}`).value = "";
      document.getElementById(`ptS${i}Unit`).value = "minutes";
      document.getElementById(`mS${i}`).value = "1";
    }
    document.getElementById("demandS").value = "";
    document.getElementById("demandSUnit").value = "per hour";

    setCell("ch3SingleCapCell", "-");
    setCell("ch3SingleFlowCell", "-");
    setCell("ch3SingleUtilCell", "-");
    setCell("ch3SingleCycleCell", "-");
    clearText("ch3SingleConversions");

    setCell("ch3MultiProcCapCell", "-");
    setCell("ch3MultiFlowCell", "-");
    setCell("ch3MultiCycleCell", "-");
    clearText("ch3MultiConversions");
  }

  /* -------- Chapter 4 (NEW): Process Improvement -------- */

  function hoursFromTime(val, unit) {
    return val * (TIME_TO_HOURS[unit] ?? 1);
  }

  function timeFromHours(hours, outUnit) {
    const factor = TIME_TO_HOURS[outUnit] ?? 1;
    return hours / factor;
  }

  function runCh4LC() {
    let totalHours = 0;
    let any = false;

    for (let i = 1; i <= 6; i++) {
      const v = parseNum(`ch4LC${i}`);
      if (v === null) continue;
      if (!isNonNegative(v)) {
        setText("ch4LCResult", "Times must be non-negative.");
        clearText("ch4LCConv");
        return;
      }
      const unit = document.getElementById(`ch4LC${i}Unit`).value;
      totalHours += hoursFromTime(v, unit);
      any = true;
    }

    if (!any) {
      setText("ch4LCResult", "Enter at least one station time.");
      clearText("ch4LCConv");
      return;
    }

    const outUnit = document.getElementById("outTimeUnitCh4").value;
    const outVal = timeFromHours(totalHours, outUnit);
    const shown = formatResult(outVal, "roundCh4");

    setText("ch4LCResult", `LC = ${shown} ${outUnit}/unit`);
    setText("ch4LCConv", `Base units: LC = ${totalHours} hours/unit.`);
  }

  function runCh4CDL() {
    const wages = parseNum("ch4Wages");
    const flow = parseNum("ch4Flow");
    if (wages === null || flow === null) {
      setText("ch4CDLResult", "Enter wages and flow rate.");
      clearText("ch4CDLConv");
      return;
    }
    if (!isNonNegative(wages) || !isNonNegative(flow)) {
      setText("ch4CDLResult", "Inputs must be non-negative.");
      clearText("ch4CDLConv");
      return;
    }
    if (flow === 0) {
      setText("ch4CDLResult", "Flow rate must be > 0.");
      clearText("ch4CDLConv");
      return;
    }

    const wUnit = document.getElementById("ch4WagesUnit").value;
    const fUnit = document.getElementById("ch4FlowUnit").value;

    const wagesPerHour = wages * (RATE_TO_PER_HOUR[wUnit] ?? 1); // $/hour
    const flowPerHour = flow * (RATE_TO_PER_HOUR[fUnit] ?? 1);  // units/hour

    const cdl = wagesPerHour / flowPerHour; // $/unit
    const shown = formatResult(cdl, "roundCh4");

    setText("ch4CDLResult", `CDL = $${shown} / unit`);
    setText("ch4CDLConv", `Base units: wages=${wagesPerHour} $/hour, flow=${flowPerHour} units/hour.`);
  }

  function runCh4AU() {
    const lc = parseNum("ch4AU_LC");
    const idle = parseNum("ch4AU_Idle");
    if (lc === null || idle === null) {
      setText("ch4AUResult", "Enter LC and idle time.");
      clearText("ch4AUConv");
      return;
    }
    if (!isNonNegative(lc) || !isNonNegative(idle)) {
      setText("ch4AUResult", "Inputs must be non-negative.");
      clearText("ch4AUConv");
      return;
    }

    const lcUnit = document.getElementById("ch4AU_LC_Unit").value;
    const idleUnit = document.getElementById("ch4AU_Idle_Unit").value;

    const lcH = hoursFromTime(lc, lcUnit);
    const idleH = hoursFromTime(idle, idleUnit);

    if (lcH + idleH === 0) {
      setText("ch4AUResult", "LC + Idle must be > 0.");
      clearText("ch4AUConv");
      return;
    }

    const au = lcH / (lcH + idleH); // fraction
    const shown = formatResult(au * 100, "roundCh4");

    setText("ch4AUResult", `AU = ${shown}%`);
    setText("ch4AUConv", `Base units: LC=${lcH} hours/unit, idle=${idleH} hours/unit.`);
  }

  function runCh4TaktAndTM() {
    const demand = parseNum("ch4Demand");
    const lc = parseNum("ch4TM_LC");
    if (demand === null || lc === null) {
      setText("ch4TaktResult", "Enter demand and LC.");
      setText("ch4TMResult", "-");
      clearText("ch4TaktTMConv");
      return;
    }
    if (!isNonNegative(demand) || !isNonNegative(lc)) {
      setText("ch4TaktResult", "Inputs must be non-negative.");
      setText("ch4TMResult", "-");
      clearText("ch4TaktTMConv");
      return;
    }
    if (demand === 0) {
      setText("ch4TaktResult", "Demand rate must be > 0.");
      setText("ch4TMResult", "-");
      clearText("ch4TaktTMConv");
      return;
    }

    const dUnit = document.getElementById("ch4DemandUnit").value;
    const lcUnit = document.getElementById("ch4TM_LC_Unit").value;
    const outTimeUnit = document.getElementById("outTimeUnitCh4").value;

    // Demand -> units/hour
    const demandPerHour = demand * (RATE_TO_PER_HOUR[dUnit] ?? 1);

    // Takt time = 1 / demand rate (hours/unit)
    const taktHoursPerUnit = 1 / demandPerHour;

    // convert to output time unit
    const taktOut = timeFromHours(taktHoursPerUnit, outTimeUnit);
    const taktShown = formatResult(taktOut, "roundCh4");

    // Target manpower = LC / TT (must be same time basis)
    const lcHours = hoursFromTime(lc, lcUnit);
    const tm = lcHours / taktHoursPerUnit;
    const tmShown = formatResult(tm, "roundCh4");

    setText("ch4TaktResult", `Takt Time = ${taktShown} ${outTimeUnit}/unit`);
    setText("ch4TMResult", `Target Manpower = ${tmShown} workers`);
    setText("ch4TaktTMConv", `Base units: demand=${demandPerHour} units/hour, TT=${taktHoursPerUnit} hours/unit, LC=${lcHours} hours/unit.`);
  }

  function runCh4Profit() {
    const flow = parseNum("ch4P_Flow");
    const fixed = parseNum("ch4P_Fixed");
    const price = parseNum("ch4P_Price");
    const vc = parseNum("ch4P_VC");

    if (flow === null || fixed === null || price === null || vc === null) {
      setText("ch4ProfitResult", "Enter flow rate, fixed cost, price, and variable cost.");
      clearText("ch4ProfitConv");
      return;
    }
    if (!isNonNegative(flow) || !isNonNegative(fixed) || !isNonNegative(price) || !isNonNegative(vc)) {
      setText("ch4ProfitResult", "Inputs must be non-negative.");
      clearText("ch4ProfitConv");
      return;
    }

    const fUnit = document.getElementById("ch4P_FlowUnit").value;
    const fixedUnit = document.getElementById("ch4P_FixedUnit").value;

    const flowPerHour = flow * (RATE_TO_PER_HOUR[fUnit] ?? 1);      // units/hour
    const fixedPerHour = fixed * (RATE_TO_PER_HOUR[fixedUnit] ?? 1); // $/hour

    const profitPerHour = (flowPerHour * (price - vc)) - fixedPerHour;

    // Show in the same time basis as the selected output rate unit
    const outRateUnit = document.getElementById("outRateUnitCh4").value;
    const outFactor = RATE_TO_PER_HOUR[outRateUnit] ?? 1; // convert per-hour to per-outUnit
    const profitOut = profitPerHour / outFactor;

    let label = "$/hour";
    if (outRateUnit === "per minute") label = "$/minute";
    if (outRateUnit === "per day") label = "$/day";

    const shown = formatResult(profitOut, "roundCh4");
    setText("ch4ProfitResult", `Profit = $${shown} ${label}`);
    setText("ch4ProfitConv", `Base units: flow=${flowPerHour} units/hour, fixed=${fixedPerHour} $/hour.`);
  }

  function resetCh4() {
    document.getElementById("roundCh4").value = "none";
    document.getElementById("outTimeUnitCh4").value = "seconds";
    document.getElementById("outRateUnitCh4").value = "per hour";

    for (let i = 1; i <= 6; i++) {
      document.getElementById(`ch4LC${i}`).value = "";
      document.getElementById(`ch4LC${i}Unit`).value = "seconds";
    }
    setText("ch4LCResult", "-");
    clearText("ch4LCConv");

    document.getElementById("ch4Wages").value = "";
    document.getElementById("ch4WagesUnit").value = "per hour";
    document.getElementById("ch4Flow").value = "";
    document.getElementById("ch4FlowUnit").value = "per hour";
    setText("ch4CDLResult", "-");
    clearText("ch4CDLConv");

    document.getElementById("ch4AU_LC").value = "";
    document.getElementById("ch4AU_LC_Unit").value = "seconds";
    document.getElementById("ch4AU_Idle").value = "";
    document.getElementById("ch4AU_Idle_Unit").value = "seconds";
    setText("ch4AUResult", "-");
    clearText("ch4AUConv");

    document.getElementById("ch4Demand").value = "";
    document.getElementById("ch4DemandUnit").value = "per hour";
    document.getElementById("ch4TM_LC").value = "";
    document.getElementById("ch4TM_LC_Unit").value = "seconds";
    setText("ch4TaktResult", "-");
    setText("ch4TMResult", "-");
    clearText("ch4TaktTMConv");

    document.getElementById("ch4P_Flow").value = "";
    document.getElementById("ch4P_FlowUnit").value = "per hour";
    document.getElementById("ch4P_Fixed").value = "";
    document.getElementById("ch4P_FixedUnit").value = "per hour";
    document.getElementById("ch4P_Price").value = "";
    document.getElementById("ch4P_VC").value = "";
    setText("ch4ProfitResult", "-");
    clearText("ch4ProfitConv");
  }

  /* -------- Chapter 5 (NEW): Complex Process Flows -------- */

  function unitLabelForRate(u) {
    if (u === "per minute") return "per minute";
    if (u === "per day") return "per day";
    return "per hour";
  }

  function runCh5IU() {
    const demand = parseNum("ch5Demand");
    const cap = parseNum("ch5Cap");
    if (demand === null || cap === null) {
      setText("ch5IUResult", "Enter demand and capacity.");
      clearText("ch5IUConv");
      return;
    }
    if (!isNonNegative(demand) || !isNonNegative(cap)) {
      setText("ch5IUResult", "Inputs must be non-negative.");
      clearText("ch5IUConv");
      return;
    }
    if (cap === 0) {
      setText("ch5IUResult", "Capacity must be > 0.");
      clearText("ch5IUConv");
      return;
    }

    const uA = document.getElementById("ch5RateUnitA").value;
    const uB = document.getElementById("ch5RateUnitB").value;

    const demandPerHour = demand * (RATE_TO_PER_HOUR[uA] ?? 1);
    const capPerHour = cap * (RATE_TO_PER_HOUR[uB] ?? 1);

    const iu = demandPerHour / capPerHour;
    const shownIU = formatResult(iu, "roundCh5");
    const shownPct = formatResult(iu * 100, "roundCh5");

    setText("ch5IUResult", `IU = ${shownIU} (${shownPct}%)`);
    setText("ch5IUConv", `Base units: demand=${demandPerHour} units/hour, capacity=${capPerHour} units/hour.`);
  }

  function runCh5Yield() {
    const succ = parseNum("ch5Succ");
    const inp = parseNum("ch5Input");
    if (succ === null || inp === null) {
      setText("ch5YieldResult", "Enter successful output and input.");
      return;
    }
    if (!isNonNegative(succ) || !isNonNegative(inp)) {
      setText("ch5YieldResult", "Inputs must be non-negative.");
      return;
    }
    if (inp === 0) {
      setText("ch5YieldResult", "Input must be > 0.");
      return;
    }
    const y = succ / inp;
    const shown = formatResult(y, "roundCh5");
    const shownPct = formatResult(y * 100, "roundCh5");
    setText("ch5YieldResult", `Yield = ${shown} (${shownPct}%)`);
  }

  function runCh5ReqInput() {
    const need = parseNum("ch5NeedOut");
    const y = parseNum("ch5YieldDec");
    if (need === null || y === null) {
      setText("ch5ReqInputResult", "Enter needed output and yield.");
      setText("ch5ReqNote", "");
      return;
    }
    if (!isNonNegative(need) || !isNonNegative(y)) {
      setText("ch5ReqInputResult", "Inputs must be non-negative.");
      setText("ch5ReqNote", "");
      return;
    }
    if (y === 0) {
      setText("ch5ReqInputResult", "Yield must be > 0.");
      setText("ch5ReqNote", "");
      return;
    }
    const req = need / y;
    const shown = formatResult(req, "roundCh5");
    setText("ch5ReqInputResult", `Input Required = ${shown} units`);
    setText("ch5ReqNote", "Note: Many slides round up to the next whole unit when units must be integers.");
  }

  function runCh5Workload() {
    let total = 0;
    let any = false;

    for (let i = 1; i <= 5; i++) {
      const v = parseNum(`ch5Vol${i}`);
      const t = parseNum(`ch5Time${i}`);

      if (v === null && t === null) {
        setText(`ch5Share${i}`, "-");
        continue;
      }

      if (v === null || t === null) {
        setText(`ch5Share${i}`, "Enter both");
        continue;
      }

      if (!isNonNegative(v) || !isNonNegative(t)) {
        setText(`ch5Share${i}`, "Non-neg only");
        continue;
      }

      const share = v * t;
      total += share;
      any = true;

      setText(`ch5Share${i}`, formatResult(share, "roundCh5"));
    }

    if (!any) {
      setText("ch5WorkloadTotal", "Enter at least one row.");
      return;
    }
    setText("ch5WorkloadTotal", `${formatResult(total, "roundCh5")} minutes`);
  }

  function runCh5Rework() {
    const std = parseNum("ch5StdTime");
    const rw = parseNum("ch5ReworkTime");
    if (std === null || rw === null) {
      setText("ch5ReworkResult", "Enter standard time and rework time.");
      clearText("ch5ReworkConv");
      return;
    }
    if (!isNonNegative(std) || !isNonNegative(rw)) {
      setText("ch5ReworkResult", "Inputs must be non-negative.");
      clearText("ch5ReworkConv");
      return;
    }
    const u1 = document.getElementById("ch5StdUnit").value;
    const u2 = document.getElementById("ch5ReworkUnit").value;

    const stdH = hoursFromTime(std, u1);
    const rwH = hoursFromTime(rw, u2);
    const totalH = stdH + rwH;

    // display in hours if either input was hours, else minutes by default
    const outUnit = (u1 === "hours" || u2 === "hours") ? "hours" : "minutes";
    const outVal = timeFromHours(totalH, outUnit);
    const shown = formatResult(outVal, "roundCh5");

    setText("ch5ReworkResult", `Actual Workload = ${shown} ${outUnit}`);
    setText("ch5ReworkConv", `Base units: standard=${stdH} hours, rework=${rwH} hours.`);
  }

  function resetCh5() {
    document.getElementById("roundCh5").value = "none";

    document.getElementById("ch5Demand").value = "";
    document.getElementById("ch5Cap").value = "";
    document.getElementById("ch5RateUnitA").value = "per hour";
    document.getElementById("ch5RateUnitB").value = "per hour";
    setText("ch5IUResult", "-");
    clearText("ch5IUConv");

    document.getElementById("ch5Succ").value = "";
    document.getElementById("ch5Input").value = "";
    setText("ch5YieldResult", "-");

    document.getElementById("ch5NeedOut").value = "";
    document.getElementById("ch5YieldDec").value = "";
    setText("ch5ReqInputResult", "-");
    setText("ch5ReqNote", "");

    for (let i = 1; i <= 5; i++) {
      document.getElementById(`ch5Type${i}`).value = "";
      document.getElementById(`ch5Vol${i}`).value = "";
      document.getElementById(`ch5Time${i}`).value = "";
      setText(`ch5Share${i}`, "-");
    }
    setText("ch5WorkloadTotal", "-");

    document.getElementById("ch5StdTime").value = "";
    document.getElementById("ch5ReworkTime").value = "";
    document.getElementById("ch5StdUnit").value = "hours";
    document.getElementById("ch5ReworkUnit").value = "hours";
    setText("ch5ReworkResult", "-");
    clearText("ch5ReworkConv");
  }

  /* -------- Accordion behavior (only one open at a time) -------- */
  document.querySelectorAll("details.calc").forEach(d => {
    d.addEventListener("toggle", () => {
      if (d.open) {
        document.querySelectorAll("details.calc").forEach(other => {
          if (other !== d) other.open = false;
        });
      }
    });
  });

  /* Initialize */
  updateLittleUI();
  resetCh3();
  resetCh4();
  resetCh5();
</script>
</body>
</html>
